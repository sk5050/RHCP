#!/usr/bin/env python

import sys
from utils import import_models
import_models()

from graph import Node, Graph
from LAOStar import LAOStar
from CSSPSolver import CSSPSolver
from grid_model import GRIDModel
from LAO_paper_model import LAOModel
import matplotlib.pyplot as plt
import time


def linspace(start, stop, n):
    if n == 1:
        yield stop
        return
    h = (stop - start) / (n - 1)
    for i in range(n):
        yield start + h * i



def draw_lower_envelop():

    init_state = (0,0)
    size = (5,5)
    goal = (4,4)
    model = GRIDModel(size, init_state, goal, prob_right_transition=0.85)

    # model = LAOModel()

    # algo = LAOStar(model)

    alpha_list = list(linspace(0,0.6,100))

    # alpha_list = [200]
    weighted_value_list = []

    bound = 1.5

    for a in alpha_list:

        print(a)

        algo = LAOStar(model,constrained=True,bounds=[bound],alpha=[a],Lagrangian=True)

        policy = algo.solve()

        value = algo.graph.root.value
        weighted_value = value[0] + a*(value[1] - bound)
        weighted_value_list.append(weighted_value)

        model.print_policy(policy)


    # print(algo.compute_value(algo.graph.nodes[(4,2)],'D'))
    # print(algo.compute_value(algo.graph.nodes[(4,2)],'U'))
    # print(algo.compute_value(algo.graph.nodes[(4,2)],'R'))
    # print(algo.compute_value(algo.graph.nodes[(4,2)],'L'))


        
    # print(alpha_list)
    # print(weighted_value_list)

    print(alpha_list)
    print(weighted_value_list)
        
    plt.plot(alpha_list, weighted_value_list,'*')
    # plt.plot(0.05775379446627887, 9.357673380261254, 'r*') # with bound = 2
    # plt.plot(0.013834705882, 9.3420861953, 'r*')  # with bound = 3
    plt.plot(0.15374170009084218, 9.42260840432311, 'r*')  # with bound = 1.5


    plt.show()




def test_dual_alg():
    init_state = (0,0)
    size = (5,5)
    goal = (4,4)
    model = GRIDModel(size, init_state, goal, prob_right_transition=0.85)

    bound = 1.5

    cssp_solver = CSSPSolver(model, bounds=[bound])

    cssp_solver.solve()



def draw_results():

    alpha_list = [0.0, 0.006060606060606061, 0.012121212121212121, 0.01818181818181818, 0.024242424242424242, 0.030303030303030304, 0.03636363636363636, 0.04242424242424243, 0.048484848484848485, 0.05454545454545454, 0.06060606060606061, 0.06666666666666667, 0.07272727272727272, 0.07878787878787878, 0.08484848484848485, 0.09090909090909091, 0.09696969696969697, 0.10303030303030303, 0.10909090909090909, 0.11515151515151516, 0.12121212121212122, 0.12727272727272726, 0.13333333333333333, 0.1393939393939394, 0.14545454545454545, 0.15151515151515152, 0.15757575757575756, 0.16363636363636364, 0.1696969696969697, 0.17575757575757575, 0.18181818181818182, 0.18787878787878787, 0.19393939393939394, 0.2, 0.20606060606060606, 0.21212121212121213, 0.21818181818181817, 0.22424242424242424, 0.23030303030303031, 0.23636363636363636, 0.24242424242424243, 0.24848484848484848, 0.2545454545454545, 0.2606060606060606, 0.26666666666666666, 0.2727272727272727, 0.2787878787878788, 0.28484848484848485, 0.2909090909090909, 0.296969696969697, 0.30303030303030304, 0.3090909090909091, 0.3151515151515151, 0.3212121212121212, 0.32727272727272727, 0.3333333333333333, 0.3393939393939394, 0.34545454545454546, 0.3515151515151515, 0.3575757575757576, 0.36363636363636365, 0.3696969696969697, 0.37575757575757573, 0.38181818181818183, 0.3878787878787879, 0.3939393939393939, 0.4, 0.40606060606060607, 0.4121212121212121, 0.41818181818181815, 0.42424242424242425, 0.4303030303030303, 0.43636363636363634, 0.44242424242424244, 0.4484848484848485, 0.45454545454545453, 0.46060606060606063, 0.4666666666666667, 0.4727272727272727, 0.47878787878787876, 0.48484848484848486, 0.4909090909090909, 0.49696969696969695, 0.503030303030303, 0.509090909090909, 0.5151515151515151, 0.5212121212121212, 0.5272727272727272, 0.5333333333333333, 0.5393939393939394, 0.5454545454545454, 0.5515151515151515, 0.5575757575757576, 0.5636363636363636, 0.5696969696969697, 0.5757575757575758, 0.5818181818181818, 0.5878787878787879, 0.593939393939394, 0.6]

    value_list = [9.2660336081208, 9.31495131931758, 9.353933852906927, 9.35619965956448, 9.356518297915477, 9.356727197134415, 9.356936096353353, 9.357144995572291, 9.357353894791231, 9.357562794010168, 9.357512734558238, 9.357171388318585, 9.356830042078931, 9.356488695839278, 9.356147349599624, 9.355806003359971, 9.355464657120317, 9.355123310880664, 9.354781964641012, 9.354440618401357, 9.354099272161704, 9.35375792592205, 9.3534165796824, 9.352501286889698, 9.34964423346327, 9.346787180036841, 9.34321890490674, 9.339237602669575, 9.33525630043241, 9.331274998195246, 9.32729369595808, 9.323312393720915, 9.31933109148375, 9.315349789246586, 9.31136848700942, 9.307387184772255, 9.30340588253509, 9.299424580297925, 9.295443278060759, 9.291461975823594, 9.28748067358643, 9.283499371349265, 9.279518069112099, 9.275536766874936, 9.27155546463777, 9.267574162400605, 9.263592860163438, 9.259611557926274, 9.255630255689109, 9.25163763171481, 9.247358341931367, 9.243079052147925, 9.238799762364485, 9.234520472581044, 9.230241182797602, 9.225961893014162, 9.22168260323072, 9.21740331344728, 9.213124023663838, 9.208844733880397, 9.204565444096959, 9.200286154313515, 9.196006864530075, 9.191727574746633, 9.187448284963192, 9.18316899517975, 9.17888970539631, 9.174610415612868, 9.170331125829428, 9.166051836045986, 9.161772546262545, 9.157493256479105, 9.153213966695663, 9.148934676912226, 9.14465538712878, 9.14037609734534, 9.136096807561898, 9.131817517778458, 9.127538227995018, 9.123258938211576, 9.118979648428136, 9.114542855279549, 9.109969357206394, 9.105395859133244, 9.10082236106009, 9.096248862986936, 9.091675364913785, 9.087101866840632, 9.08252836876748, 9.07795487069433, 9.073381372621176, 9.068807874548028, 9.064234376474875, 9.059660878401724, 9.05508738032857, 9.050513882255416, 9.045940384182263, 9.039466927525435, 9.03004684590168, 9.020484931718554]


    


draw_lower_envelop()
# test_dual_alg()
